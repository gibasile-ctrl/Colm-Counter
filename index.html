<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Colm Counter Live</title>
  <style>
    body{font-family:system-ui,sans-serif;margin:0;background:#0b1220;color:#e5e7eb;padding:12px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .btn{padding:8px 12px;margin:2px;border-radius:8px;border:none;cursor:pointer;background:#1f2937;color:#e5e7eb}
    .btn.good{background:#15803d}
    .btn.bad{background:#b91c1c}
    .btn.primary{background:#0e7490}
    .panel{background:#111827;padding:12px;border-radius:12px;margin-bottom:12px}
    table{width:100%;border-collapse:collapse;font-size:14px;margin-top:8px}
    th,td{padding:6px;border-bottom:1px solid #243041;text-align:left}
    th{position:sticky;top:0;background:#111827}
    .roast{white-space:pre-wrap;background:#0b1220;border:1px dashed #334155;border-radius:8px;padding:8px;margin-top:8px}
  </style>
</head>
<body>

<header>
  <h1>üèÜ Colm Counter Live</h1>
  <div>
    <button class="btn" id="resetBtn">Reset Session</button>
  </div>
</header>

<section class="panel">
  <h2>Player</h2>
  <input id="player" placeholder="Enter player name" />
  <div>
    <button class="btn primary" id="startBtn">Start Game</button>
  </div>
</section>

<section class="panel" id="throwArea" style="display:none">
  <h2>Log Throws</h2>
  <button class="btn good" data-outcome="board">On board (1)</button>
  <button class="btn good" data-outcome="hole">In hole (3)</button>
  <button class="btn" data-outcome="miss">Miss (0)</button>
  <button class="btn bad" data-outcome="frontfloor">Front-floor üí•</button>
</section>

<section class="panel">
  <h2>Live Stats</h2>
  <table>
    <thead>
      <tr><th>#</th><th>Player</th><th>Total Throws</th><th>Front-floor</th><th>Note</th></tr>
    </thead>
    <tbody id="logTbl"></tbody>
  </table>
</section>

<section class="panel">
  <h2>Roast üî•</h2>
  <button class="btn" id="roastBtn">Generate Roast</button>
  <div class="roast" id="roastBox">No roast yet.</div>
</section>

<!-- FIREBASE MODULE START -->
<script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBPr5o01_7eu_6CwnIGnU-8Xk0VkvrhCpQ",
    authDomain: "colm-counter.firebaseapp.com",
    databaseURL: "https://colm-counter-default-rtdb.firebaseio.com",
    projectId: "colm-counter",
    storageBucket: "colm-counter.firebasestorage.app",
    messagingSenderId: "816396612687",
    appId: "1:816396612687:web:722d998566acb90276e63a",
    measurementId: "G-8K696QXP4G"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getDatabase(app);

  // Export db for app logic
  window.db = db;
  window.firebaseRef = ref;
  window.firebasePush = push;
  window.firebaseSet = set;
  window.firebaseOnValue = onValue;
</script>
<!-- FIREBASE MODULE END -->

<script>
  // MAIN APP LOGIC
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  const state = { player:'Player', throws:[] };
  let currentGameId = null;

  function addThrow(key){
    const t = { outcome: key, timestamp: Date.now(), player: state.player };
    state.throws.push(t);

    // Create game if none
    if(!currentGameId){
      currentGameId = firebasePush(firebaseRef(db, 'games')).key;
      firebaseSet(firebaseRef(db, `games/${currentGameId}`), {
        player: state.player,
        timestamp: Date.now()
      });
    }

    firebasePush(firebaseRef(db, `games/${currentGameId}/throws`), t);
  }

  function resetSession(){
    state.throws = [];
    currentGameId = null;
    $('#throwArea').style.display='none';
    $('#player').value='';
  }

  function onTap(el, fn){
    el.addEventListener('click', fn);
  }

  onTap($('#startBtn'), ()=>{
    state.player = $('#player').value.trim() || 'Player';
    $('#throwArea').style.display='block';
  });

  onTap($('#resetBtn'), resetSession);

  // Handle throw buttons
  $$('#throwArea button').forEach(btn=>{
    btn.addEventListener('click', ()=> addThrow(btn.getAttribute('data-outcome')));
  });

  // Roast generation
  onTap($('#roastBtn'), ()=>{
    if(!state.throws.length){ $('#roastBox').textContent='Log some throws first.'; return; }
    const ffCount = state.throws.filter(t=>t.outcome==='frontfloor').length;
    let lines = [`${state.player}'s session: ${state.throws.length} throws.`];
    if(ffCount>=4) lines.push('üî• Floor Bagger! Watch the floor!'); 
    else lines.push(`Front-floor throws: ${ffCount}`);
    $('#roastBox').textContent = lines.join('\n');
  });

  // Live stats listener
  function listenGames(){
    firebaseOnValue(firebaseRef(db, 'games'), snapshot=>{
      const gamesData = snapshot.val() || {};
      const tb = $('#logTbl');
      tb.innerHTML = '';
      Object.entries(gamesData).forEach(([id, g], i)=>{
        const throws = g.throws ? Object.values(g.throws) : [];
        const ff = throws.filter(t=>t.outcome==='frontfloor').length;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td>
                        <td>${g.player}</td>
                        <td>${throws.length}</td>
                        <td>${ff}</td>
                        <td>${ff>=4?'üî• Floor Bagger!':''}</td>`;
        tb.appendChild(tr);
      });
    });
  }

  listenGames();
</script>

</body>
</html>
